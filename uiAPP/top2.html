<xmp>
    <ui:movepanel class="bgray15 zidx3" p-name="tree" title="组件树">
        <set style="max-width:1000px;max-height:600px;overflow-x:scroll;overflow-y:scroll;"></set>
    </ui:movepanel>
    <ui:movepanel class="bgray15 zidx3" p-name="source">
        <set style="max-width:1000px;max-height:600px;overflow-x:scroll;overflow-y:scroll;"></set>
    </ui:movepanel>
    <div p-ref="rectmask" class="abs zidx10 noevent" style="background-color:rgba(0,128,192,0.5);"></div>
    <div id="header_wrap" class="outer">
        <div class="zidx3 right0" style="position:fixed;">
            <ui:growpanel p-name="control" title="JS控制台" extend="0" class="bgray15" style="font-family: 微软雅黑;">
                <div class="mdip2">
                    <textarea p-ref="script" class="fz18 bgray4 wem20 hem10 fgray15 bdw0 rdip5 pdip5" style="outline-width: 0; resize:none;"></textarea>
                    <br/>
                    <a p-ref='run' href="javascript:;">运行 >:_</a>
                    <script>
                        part.$run.onclick=function(){
                            part.$ret.valueOf().innerHTML=eval(part.$script.value);
                        }
                    </script>
                    <br/>
                    <textarea p-ref="ret" class="rdip5 bgray4 fgray15 fz18 w100 hem10 fgray15 bdw0" style="outline-width: 0; resize:none;"></textarea>
                </div>
            </ui:growpanel>
        </div>
        <header class="inner">
          <h1 id="project_title">Turtlejs（龟计算）</h1>
          <h2 id="project_tagline">make it for fun（预览版）</h2>
          本教程用turtlejs编写（<a p-ref="remove" href="javascript:;">删除顶部</a>）<br>
          本页清单（
          <set class="mdip5">
          <a p-ref="source" href="javascript:;">源码</a>
          <a p-ref="btn" href="javascript:;">组件实例</a>
          <a p-ref="uilist" href="javascript:;">组件清单</a>
          </set>）
          <script>
               var 
                    btn=part.$btn,
                    uilist=part.$uilist,
                    source=part.$source,
                    rectmask=part.$rectmask,
                    remove=part.$remove,
                    tree=$t.parts.tree.pop(),
                    pcontrol=$t.parts.control.pop();
               remove.onclick=function(){
                   part.remove();
               }
               btn.onclick=function(){
                    var elems=[];
                    var elem;
                    function append(cpns,space){
                        for(var i=0;i<cpns.length;i++){
                            var elem=$t.$$$("div");
                            elem.innerHTML='&lt;<span style="color:#c00;">'+cpns[i].template.sortPath+'</span>:<span style="color:#00f;">'+cpns[i].template.partName+'</span>&gt;<span style="color:#aaa;">props='+JSON.stringify(cpns[i].props)+'</span>';
                            elem.style.paddingLeft=space+"em";
                            
                            elems.push(elem);
                            
                            var elem2=$t.$$$("a");
                            elem2.href="javascript:;";
                            elem2.innerHTML=" (删除) ";
                            
                            var elem3=$t.$$$("a");
                            elem3.href="javascript:;";
                            elem3.innerHTML=" (元素) ";
                            
                            var elem4=$t.$$$("a");
                            elem4.href="javascript:;";
                            elem4.innerHTML=" (定义) ";
                            var hideMask=$t.getReTimeout(function(){
                                rectmask.style.width='0';
                                rectmask.style.height='0';
                            });
                            (function(cpn){
                                elem2.onclick=function(){
                                    cpn.remove();
                                    refresh();
                                }
                                elem3.onclick=function(){
                                    var highlight=$t.renderBefore("highlightcode",'ui',part.end,[$t.$$$(cpn.innerHTML,3)]);
                                    pSource.setContent(highlight.elements);
                                    pSource.setTitle(cpn.template.name);
                                    pSource.show();
                                }
                                elem4.onclick=function(){
                                    var highlight=$t.renderBefore("highlightcode",'ui',part.end,[$t.$$$('<script>'+cpn.template.toDefineString()+'</sc'+'ript>',3)]);
                                    pSource.setContent(highlight.elements);
                                    pSource.setTitle(cpn.template.name);
                                    pSource.show();
                                }
                                
                                elem.onmouseenter=function(){
                                    var rect=cpn.getRect();
                                    rectmask.style.left=rect.left+'px';
                                    rectmask.style.top=rect.top+'px';
                                    rectmask.style.width=rect.width+'px';
                                    rectmask.style.height=rect.height+'px';
                                    hideMask(3000);
                                }
                            })(cpns[i]);
                            
                            elem.insertBefore(elem4,elem.childNodes[0]);
                            elem.insertBefore(elem3,elem4);
                            elem.insertBefore(elem2,elem3);
                            
                            var cpn=cpns[i].child;
                            if(cpn.length>0){
                                append(cpn,space+2);
                            }
                        }
                    }
                    append($t.rootParts,0);
                    tree.show();
                    tree.setContent(elems);
                }
                $t.service.runJS=function(script){
                    pcontrol.$script.value=script;
                    pcontrol.max();
                    try{
                        pcontrol.$ret.innerHTML=eval(script);
                    }catch(e){
                        pcontrol.$ret.innerHTML=e.stack;
                    }
                }
                uilist.onclick=function(){
                    $t.service.runJS('$t.ui.toString()');
                }
                tree.hide();
                var pSource=$t.parts.source.last();
                var html;
                $t.xhr.get(location.href,true,function(v){html=v});
                source.onclick=function(){
                    var htmltext=$t.$$$(html,3);
                    var highlight=$t.renderBefore("highlightcode",'ui',part.end,[htmltext]);
                    pSource.setContent(highlight.elements);
                    pSource.setTitle('本页源码');
                    pSource.show();
                }
                pSource.hide();
                $t.onResize(function(){
                    part.emitResize();
                });
                
          </script>
        </header>
    </div>
</xmp>