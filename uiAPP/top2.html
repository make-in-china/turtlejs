<xmp service="runJS">
    function(script){
        $t.refs.script[0].value=script;
        $t.ui.growpanel.parts[0].max();
        try{
            $t.refs.ret[0].innerHTML=eval(script);
        }catch(e){
            $t.refs.ret[0].innerHTML=e.stack;
        }
    }
</xmp>
<xmp>
    <div id="header_wrap" class="outer">
        <div class="zidx3 fixed right0">
            <set lazy append class="bgray15" style="font-family: 微软雅黑;">
                <ui:growpanel title="JS控制台" extend="0">
                    <div class="mdip2">
                        <textarea ref="script" class="fz18 bgray4 wem20 hem10 fgray15 bdw0 rdip5 pdip5" style="outline-width: 0; resize:none;"></textarea>
                        <br/>
                        <a href="javascript:;">运行 >:_
                            <script type="on">
                                click:function(){$t.refs.ret[0].innerHTML=eval($t.refs.script[0].value);}
                            </script>
                        </a>
                        <br/>
                        <textarea ref="ret" class="rdip5 bgray4 fgray15 fz18 w100 hem10 fgray15 bdw0" style="outline-width: 0; resize:none;"></textarea>
                    </div>
                </ui:growpanel>
                
                <ui:panel partname="tree" title="组件树"></ui:panel>
                <ui:panel partname="source" title="本页源码"><set style="max-width:800px;max-height:400px;overflow-x:scroll;overflow-y:scroll;"></set></ui:panel>
            </set>
            
        </div>
        <header class="inner">
          <h1 id="project_title">Turtlejs（龟计算）</h1>
          <h2 id="project_tagline">make it for fun（预览版）</h2>
          本教程用turtlejs编写<br>
          <set class="mdip5">
          <a ref="source" href="javascript:;">查看未压缩源码</a>
          <a ref="btn" href="javascript:;">查看组件树</a>
          <a ref="uilist" href="javascript:;">查看本页组件</a>
          </set>
          <script>
               var btn=$t.refs.btn.pop();
               var uilist=$t.refs.uilist.pop();
               var source=$t.refs.source.pop();
               btn.onclick=function(){
                    var elems=[];
                    var elem;
                    function append(cpns,space){
                        for(var i=0;i<cpns.length;i++){
                            var elem=document.createElement("div");
                            elem.innerHTML='&lt;<span style="color:#c00;">'+cpns[i].template.sortPath+'</span>:<span style="color:#00f;">'+cpns[i].template.partName+'</span>&gt;<span style="color:#aaa;">props='+JSON.stringify(cpns[i].props)+'</span>';
                            elem.style.paddingLeft=space+"em";
                            
                            elems.push(elem);
                            
                            var elem2=document.createElement("a");
                            elem2.href="javascript:;";
                            elem2.innerHTML="删";
                            (function(c){
                                elem2.onclick=function(){
                                    c.remove();
                                    refresh();
                                }
                            })(cpns[i]);
                            
                            elem.insertBefore(elem2,elem.childNodes[0]);
                            
                            
                            var c=cpns[i].child;
                            if(c.length>0){
                                append(c,space+2);
                            }
                        }
                    }
                    append($t.rootParts,0);
                    var tree=$t.ui.panel.parts[0];
                    tree.show();
                    tree.setContent(elems);
                }
                btn.onclick();
                uilist.onclick=function(){
                    $t.service.runJS('$t.ui.toString()');
                }
                $t.parts.tree.last().hide();
                var pSource=$t.parts.source.last();
                var html;
                $t.xhr.get(location.href,true,function(v){html=v});
                source.onclick=function(){
                    
                    var title=document.createElement('title');
                    title.innerHTML=html;
                    var highlight=$t.renderBefore("highlightcode",'ui',part.end,[title]);
                    
                    pSource.setContent(highlight.elements);
                    pSource.show();
                }
                pSource.hide();
          </script>
        </header>
        
    </div>
</xmp>