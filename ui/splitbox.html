<xmp extends='base'>
    <div p-main class="uof iborderbox" style="width:{width!100%};height:{height!100%};background-color:{bgcolor!}.color;"></div>
    <div :="$t.removeNode(node)" p-ref="pt" style="z-index:2;" class="abs borderbox"></div>
    <script>
        var size="{size!}.only(width,height;width)";
        var minWidth={minwidth!}.intmin(4);
        var width={width!50}.string;
        var height={height!50}.string;
        part.$.init(part,props,size,outerElement,minWidth,width,height);
    </script>
</xmp>
<script xmp ui="splitbox" service="init">
    function(part,props,size,outerElement,minWidth,width,height){
        var content=part.partMain;
        var pt=part.$pt;
        var style;
        var clonePt;
        if(size==='width'){
            $t.addClass(content,'ifloat');
        }
        var setContent=part.setContent=function(elems){
            content.innerHTML='';
            $t.appendNodes(elems,content);
            $t.initHTML(elems,null,null,null,part);
            //part.emitResize();
            var pts=[];
            if(size==='width'){
                var resize=function(){
                    var width=0;
                    var pos=elems.length-1;
                    if(pos>0){
                        for(var i=0;i<pos;i++){
                            width+=elems[i].offsetWidth;
                        }
                        width=content.offsetWidth-width;
                        
                        var elem=elems[pos];
                        while((width<minWidth||elem.noresize)&&pos>0){
                            if(!elem.noresize){
                                elem.style.width=minWidth+'px';
                            }else{
                                width-=elem.offsetWidth-minWidth;
                            }
                            pos--;
                            elem=elems[pos];
                            width+=elem.offsetWidth-minWidth;
                        }
                        if(!elem.noresize){
                            if(width<minWidth){
                                elem.style.width=minWidth+'px';
                                /*分摊多余的宽度*/
                                var pos=elems.length-1;
                                width=(minWidth-width)/pos;
                                for(var i=0;i<pos;i++){
                                    elems[i].style.width=elems[i].offsetWidth-width+'px';
                                }
                            }else{
                                elem.style.width=width+'px';
                            }
                        }else{
                            if(width<elem.offsetWidth){
                                /*分摊多余的宽度*/
                                var pos=elems.length-1;
                                width=(elem.offsetWidth-width)/pos;
                                for(var i=0;i<pos;i++){
                                    elems[i].style.width=elems[i].offsetWidth-width+'px';
                                }
                            }
                        }
                    }
                    for(var i=0;i<pts.length;i++){
                        pt=pts[i];
                        elem=pt.elem;
                        style=pt.style;
                        style.left=elem.offsetLeft+elem.offsetWidth-4+'px';
                        style.top=elem.offseTop+'px';
                    }
                }
                var needGiveWidth=[];
                
                var width=0,elem;
                for(var i=0;i<elems.length;i++){
                    var elem=elems[i];
                    elem.style.height="100%";
                    if(elem.hasAttribute('noresize')){
                        elem.noresize=true;
                    }
                    if(elem.style.width===''){
                        needGiveWidth.push(elem)
                    }else if(elem.offsetWidth<minWidth&&!elem.noresize){
                        elem.style.width=minWidth+'px';
                    }
                    width+=elem.offsetWidth;
                }
                if(needGiveWidth.length>0){
                    width=(content.offsetWidth-width)/needGiveWidth.length;
                    if(width<minWidth){
                        width=minWidth;
                    }
                    for(var i=0;i<needGiveWidth.length;i++){
                        needGiveWidth[i].style.width=width+'px';
                    }
                }
                // .style.width=minWidth+'px';
                resize();
            }
            for(var i=0;i<elems.length-1;i++){
                elem=elems[i];
                if(elem.noresize){
                    continue;
                }
                clonePt=pt.cloneNode();
                pts.push(clonePt);
                (function(pt,elem){
                    style=pt.style;
                    pt.elem=elem;
                    switch(size){
                        case 'width':
                            style.left=elem.offsetLeft+elem.offsetWidth-4+'px';
                            style.top=elem.offseTop+'px';
                            style.width='4px';
                            style.height=elem.offsetHeight+'px';
                            style.cursor='col-resize';
                            $t.dropMove(pt,pt,1,0,function(){
                                var width=pt.offsetLeft-elem.offsetLeft+4;
                                if(width<minWidth){
                                    width=minWidth;
                                }
                                elem.style.width=width+'px';
                                part.emitResize();
                            });
                            break;
                    }
                })(clonePt,elem);
            }
            $t.appendNodes(pts,content);
            part.onresize=resize;
            part.emitResize();
        }
        $t.readyByRenderDocument.on(function(){
            setContent(outerElement);    
        });
    }
</script>