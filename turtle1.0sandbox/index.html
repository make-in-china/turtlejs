<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
  <head>
    <title>教程</title>
    <meta charset="utf-8">
    <meta name="description" content="Turtlejs : make it for fun">
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../css/turtle.min.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/fonts/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/stylesheet.css">
    
    <script extend="1" baseUIPath="{name:'ui',path:'../ui'};{name:'app',path:'../uiAPP'}" src="../js/turtle.js"></script>
  </head>
  <body style="overflow:scroll;">
    <xmp ui="toolbtn"><div class="pdip2" style="display:inline-block;cursor:pointer;">
            <ui:tooltip minwidth="150px">{sortpath!}:{name!}<br>{desc!}</ui:tooltip>
            <div ref='toolbtn' class="pdip5 rem1 fz12 ct2 bblue12">
                <img ref="img" class="wem3 hem3"/>
            </div>
        </div><script var='toolbtn'>
            
            var img=part.elemImg=$t.refs.img.pop();
            var name={name!}.string();
            var sortPath={sortpath!}.string();
            var iconPath={icon!}.string();
            var desc={desc!}.string();
            if(iconPath){
                img.src=iconPath;
            }else{
                img.src="../images/nofind.png";
            }
            part.check=function(){
                part.$.clearCheck();
                $t.removeClass(toolbtn,'bblue12');
                $t.addClasses(toolbtn,['bblue8','shadow-10']);
                $rootScope.sortPath=sortPath;
                $rootScope.toolicon=iconPath;
                $rootScope.desc=desc;
                $rootScope.toolName=name;
            }
            toolbtn.onclick=function(){
                part.check();
            }
        </script></xmp>
    <xmp ui="toolbtn" service="clearCheck">
        function(){
            var btns=$t.refs.toolbtn;
            for(var i=0;i<btns.length;i++){
                $t.removeClasses(btns[i],['bblue8','shadow-10']);
                $t.addClass(btns[i],'bblue12');
            }
            $rootScope.toolName='';
        }
    </xmp>
    <xmp ui="paramitem">
        <!scope m|i:0,datas:props.data>
        <!for ;i<props.data.length;i++>
        <div>
            <span : style.color:="props.data[i].necessary?'#f00':''"><!= props.data[i].name+(props.data[i].necessary?'*':'')></span>：<br><input : bind:="'datas.'+i+'.value'"/></div>
        </div>
        <!end>
        <div>innerHTML:<br><textarea ref="innerHTML"></textarea></div>
        <div><input ref="useRect" type="checkbox" checked="1">设置位置：
             <div><input ref="useLeft" type="checkbox" checked="1">左<input class="wem3" ref="l" : value:="props.rect.left"><input ref="useTop" type="checkbox" checked="1">上<input class="wem3" ref="t" : value:="props.rect.top"></div>
             <div><input ref="useWidth" type="checkbox" checked="1">宽<input class="wem3" ref="w" : value:="props.rect.width"><input ref="useHeight" type="checkbox" checked="1">高<input class="wem3" ref="h" : value:="props.rect.height"></div>
        </div>
    </xmp>
    <xmp ui="paraminputbox">
        <div ref="panel" class="abs pdip15 left0 top0 right0 bottom0 ct uhide zidx10">
            <div class="rdip15 ipdip5 pdip1" style="background-image:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#29c3e9), to(#09a3c9));-webkit-box-shadow: inset 0 0 0.0625em #000,.125em .125em 1em rgba(0,0,0,.2);box-shadow:inset 0 0 0.0625em #000,.125em .125em 1em rgba(0,0,0,.2);">
                <div></div>
                <div ref="title" class="ct fb fgray15 pdipb10"></div>
                <div ref="content" class="bgray15 ipdip2 ilb fz16 ibdgray12"></div>
                <div class="bgray15 rdipb14 hdip24 ifloat ict">
                    <div ref="cancel" class="w50 h100" style="cursor:pointer;">取消</div>
                    <div ref="ok" class="w50 h100" style="cursor:pointer;">确定</div>
                </div>
            </div>
        </div>
        <script>
            var elemPanel=part.elemPanel=$t.refs.panel.pop();
            var elemTitle=part.elemTitle=$t.refs.title.pop();
            var elemContent=part.elemContent=$t.refs.content.pop();
            var elemOK=part.elemOK=$t.refs.ok.pop();
            var elemCancel=part.elemCancel=$t.refs.cancel.pop();
            elemCancel.onclick=function(){
                cancel();
            }
            function cancel(){
                fnCancel();
                fnCancel=null;
                fnOK=null;
                $t.addClass(elemPanel,'uhide');
                paramPart.remove();
                window.removeEventListener('keydown',onkeydown);
            }
            var fnOK,fnCancel,paramPart;
            function onkeydown(e){
                if(e.which===13){
                    
                    elemOK.onclick();
                }else if(e.which===27){
                    elemCancel.onclick();
                }
            }
            elemOK.onclick=function(){
                var data=paramPart.props.data;
                var newP={};
                for(var i=0;i<data.length;i++){
                    if(data[i].value===''){
                        if(data[i].necessary){
                            return;
                        }else{
                            newP[data[i].name]=undefined;
                        }
                    }else{
                        newP[data[i].name]=data[i].value;
                    }
                }
                var fn=fnOK;
                var ihtml=$t.refs.innerHTML.last().value;
                var useRect=$t.refs.useRect.last().checked;
                var useLeft=$t.refs.useLeft.last().checked;
                var useTop=$t.refs.useTop.last().checked;
                var useWidth=$t.refs.useWidth.last().checked;
                var useHeight=$t.refs.useHeight.last().checked;
                var l=$t.refs.l.last().value;
                var t=$t.refs.t.last().value;
                var w=$t.refs.w.last().value;
                var h=$t.refs.h.last().value;
                cancel();
                fn(newP,ihtml,useRect,useLeft,useTop,useWidth,useHeight,l,t,w,h);
            }
            part.show=function(title,params,rect,fn,fnc){
                for(var i in params){
                    params[i].value='';
                }
                elemContent.innerHTML='';
                paramPart=$t.renderIn('paramitem','ui',elemContent,null,null,{data:params,rect:rect});
                window.addEventListener('keydown',onkeydown);
                elemTitle.innerHTML='请输入参数（'+title+'）';
                $t.removeClass(elemPanel,'uhide');
                fnOK=fn;
                fnCancel=fnc;
            }
        </script>
    </xmp>
    <xmp ui='toolbar'>
        <div partMain class="imdip2 ihbskyblue15 ifloat ipdip5 irem1 ibblue15 ict2 ifgray15 ishadowless pdip5 uof">
            <set lazy append style="cursor: pointer;">
            <!scope m|data:props.data.split(','),i:0>
            <!for ;i<data.length;i++><div><!= data[i]></div><!end>
            </set>
        </div>
    </xmp>
    <xmp ui="drawui">
        <div tabname="沙盒" class="shadowless full">
            <input ref="highlight" type="checkbox" checked="1"/>鼠标高亮<span class="fgray8">（绘制组件时按住ctrl可多次绘制）</span>
            <ui:toolbar partname="drawtoolbar" data="审查节点,审查组件,审查属性,审查API,前移,后移,上移,复制,剪切,粘贴,删除"></ui:toolbar>
            <div ref="panel" class="full shadowless uof" style="cursor:pointer;">
                
              <!--   <div style="color:#d0d0d0">
    <div>    3.点击矩形出现菜单（显示属性，跳转到dom节点）</div>
    <div>    5.拖移组件和标签（切换父和脱离父）</div>
    <div>    6.鼠标移动时高亮</div> 
                </div>-->
                <div ref="rect" style="background-color:rgba(0,128,255,0.5);z-index:2147483647;" class="abs uhide"></div>
                <div ref="rect2" style="background-color:rgba(0,128,255,0.2);z-index:2147483647;" class="abs uhide noevent"></div>
            </div>
        </div>
        <script>
            var panel=part.elemPanel=$t.refs.panel.pop();
            var elemRect=part.elemRect=$t.refs.rect.pop();
            var rect2=part.elemRect2=$t.refs.rect2.pop();
            var highlight=part.elemHighlight=$t.refs.highlight.pop();
            var pt1,pt2;
            var style=elemRect.style;
            var x1,y1;
            var body=document.body;
            var pib=$t.parts.pib.pop();
            var drawtoolbar=$t.parts.drawtoolbar.pop();
            part.onresize=function(){
                panel.style.top=drawtoolbar.partMain.offsetHeight+drawtoolbar.partMain.offsetTop+'px';
            }
            var name,key;
            
            window.addEventListener('keydown',function(e){
                key=e.which;
            });
            window.addEventListener('keyup',function(e){
                key='';
            });
            var dropRect=new $t.DropRect(panel,function(x,y){
                name=$rootScope.toolName;
                $t.removeClass(elemRect,'uhide');
                x1=body.scrollLeft;
                y1=body.scrollTop;
                style.left=x+x1+'px';
                style.top=y+y1+'px';
                style.width='0';
                style.height='0';
            },function(rect){
                style.left=rect.left+x1+'px';
                style.top=rect.top+y1+'px';
                style.width=rect.width+body.scrollLeft-x1+'px';
                style.height=rect.height+body.scrollTop-y1+'px';
            },function(rect){
                if(key!==17){
                    $t.ui.toolbtn.service.clearCheck();    
                };
                $t.addClass(elemRect,'uhide');
                if(rect.width===0&&rect.height===0){
                    return;
                }
                pushUI(rect,name);
            });
            var pushUI=part.pushUI=function(rect,name){
                var elems=[];
                var begin=document.elementFromPoint(rect.screenLeft,rect.screenTop);
                elems.push(begin);
                var end=document.elementFromPoint(rect.screenLeft+rect.width,rect.screenTop+rect.height);
                if(begin!==end){
                    elems.push.apply(elems,getElementsBetween(begin,end));
                    elems.push(end);
                }
                /*
                 * 键入参数
                 */
                
                var ui=$t.importUIHTML(name,$rootScope.sortPath);
                rect.left+=x1;
                rect.top+=y1;
                $t.removeClass(elemRect,'uhide');
                pib.show(name,ui.getParamsHelp(),rect,function(props,iHTML,useRect,useLeft,useTop,useWidth,useHeight,l,t,w,h){
                    var div=document.createElement('div');
                    div.innerHTML=iHTML;
                    if(elems.length>1){
                        var pos=$t.getOffsetPos(begin.parentNode,panel);
                        var render=$t.renderBefore;
                    }else{
                        var pos=$t.getOffsetPos(begin,panel);
                        var render=$t.renderIn;
                    }
                    var part=render(name,'ui',begin,$t.slice.call(div.childNodes),$t.slice.call(div.children),props);
                    if(useRect){
                        var rect={left:l-pos.x,top:t-pos.y,width:w,height:h};
                        if(!useLeft){
                            rect.left='';
                        }
                        if(!useTop){
                            rect.top='';
                        }
                        if(!useWidth){
                            rect.width='';
                        }
                        if(!useHeight){
                            rect.height='';
                        }
                        part.setSize(rect);
                    }
                },function(){
                    $t.addClass(elemRect,'uhide');
                });
            }
            var select=part.select=function(rect,name){
                var elems=[];
                var begin=document.elementFromPoint(rect.screenLeft,rect.screenTop);
                elems.push(begin);
                var end=document.elementFromPoint(rect.screenLeft+rect.width,rect.screenTop+rect.height);
                elems.push.apply(elems,getElementsBetween(begin,end));
                elems.push(end);
            }
            panel.onmouseenter=function(){
                $t.ui.tooltip.service.hideAll();
            }
            function mouseMove(e){
                var elem=document.elementFromPoint(e.x,e.y);
                var pos=$t.getOffsetPos(elem,panel);
                var style=rect2.style;
                $t.removeClass(rect2,'uhide');
                style.left=pos.x+'px';
                style.top=pos.y+'px';
                style.width=elem.offsetWidth+'px';
                style.height=elem.offsetHeight+'px';
            }
            panel.ondblclick=function(e){
                var elem=e.target;
                $t.parts.tool1[0].check(2);
            }
            highlight.onchange=function(){
                if(highlight.checked){
                    panel.addEventListener('mousemove',mouseMove);
                    panel.addEventListener('mouseout',mouseOut);
                }else{
                    panel.removeEventListener('mousemove',mouseMove);
                    panel.removeEventListener('mouseout',mouseOut);
                }
            }
            function mouseOut(e){
                var pos=panel.compareDocumentPosition(e.toElement);
                if(pos<=4){
                    $t.addClass(rect2,'uhide');
                }
            }
            panel.addEventListener('mousemove',mouseMove);
            panel.addEventListener('mouseout',mouseOut);
            // panel.removeEventListener('mousemove',mouseMove);
            $t.bindFunction($rootScope,'toolName',$t.getStep(function(v){
                if(v){
                    panel.style.cursor="crosshair";
                    
                    dropRect.on();
                }else{
                    panel.style.cursor="pointer";
                    
                    dropRect.off();
                }
            },2));
            
        </script>
    </xmp>
    <xmp>
        <!var toolName:'',sortPath:'',toolicon:'',desc:''>
        <app:top2></app:top2>
        <app:content key="Sandbox">
            <ui:button skin="fround" text='沙盘配置：官方组件'></ui:button>
            <set style="max-width:100%;"></set>
                <ui:splitbox height="1024px"  minwidth="300">
                    <div style="width:200px;padding:5px;">
                        <ui:tabbox partName="tool1">
                            <div tabname="组件">
                                <div class="pdip10 fz14">
                                    <div class="hem4">
                                    <ui:vctrl minwidth="40">
                                    <div class="ipdip5 irem1 ibblue15 ict2 imdip5 ifloat ifgray15 ishadowless iwem2">
                                        <div>新建组件</div>
                                        <div>编辑组件</div>
                                    </div>
                                    <div><div show="toolName!=''" class="pdipl10 shadowless pdip5 rem1"
                                        ><img : :src="toolicon" class="fz20 wem1 hem1 bblue12 rdip5 pdip2"
                                        /><span style="vertical-align: top;"><!- sortPath>:<!- toolName></span><span style="display:inline-block;cursor: pointer;font-size:16px;" class="abs right5 mdipl5 wem1 hem1 ct2 lhem1 pdip2 rem1 bred12 fgray15 hbred15">x
                                        <script type="on">click:function(){  
                                        $t.ui.toolbtn.service.clearCheck();                                          
                                    }</script></span><div><!- desc></div></div>
                                    </div>
                                    </ui:vctrl>
                                    </div>
                                </div>
                                <!async>
                                <!! $rootScope.partsInfo=$t.require('partsInfo.js','partsInfo');>
                                <!var i:0,j:0>
                                <!for ;i<partsInfo.length;i++>
                                    <ui:growpanel extend="1" : title:="partsInfo[i].name">
                                        <ui:vctrl lazy minwidth="50">
                                        <!for j=0;j<partsInfo[i].data.length;j++>
                                            <ui:toolbtn : icon:="partsInfo[i].data[j].icon" sortpath:="partsInfo[i].data[j].sortPath" name:="partsInfo[i].data[j].name" desc:="partsInfo[i].data[j].desc"></ui:toolbtn>
                                        <!end>
                                        </ui:vctrl>
                                    </ui:growpanel>
                                <!end>
                                <!! part.emitResize()>
                                <!end>
                                <ui:paraminputbox partname="pib"></ui:paraminputbox>
                            </div>
                            <div tabname="标签">
                            </div>
                            <div tabname="标签属性">
                                
                            </div>
                        </ui:tabbox>
                    </div>
                    <div>
                        <ui:tabbox lazy>
                            <ui:drawui></ui:drawui>
                            <div tabname="DOM树">DOM树</div>
                            <div tabname="源码">源码</div>
                            <div tabname="组件沙盒">组件沙盒</div>
                            <div tabname="帮助">帮助</div>
                        </ui:tabbox>
                    </div>
                </ui:splitbox>
        </app:content>
        <app:bottom></app:bottom>
    </xmp>
  </body>
</html>

