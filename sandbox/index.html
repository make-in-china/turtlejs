<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
  <head>
    <title>教程</title>
    <meta charset="utf-8">
    <meta name="description" content="Turtlejs : make it for fun">
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../css/turtle.min.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/fonts/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/stylesheet.css">
    
    <script extend="1" baseuipath="{name:'ui',path:'../ui'};{name:'app',path:'../uiAPP'}" src="../js/turtle.js"></script>
  </head>
  <body style="overflow:scroll;">
    <xmp ui="toolbtn"><div class="pdip2" style="display:inline-block;cursor:pointer;">
            <ui:tooltip minwidth="150px">{sortpath!}:{name!}<br>{desc!}</ui:tooltip>
            <div ref='toolbtn' style='-webkit-background-size:80% 80%;background-size: 80%;background-repeat: no-repeat;background-position: center;' class="pdip5 rem1 fz12 ct2 bblue12 wem2 hem2"></div>
        </div>
        <script var='toolbtn'>
            var name={name!}.string();
            var sortPath={sortpath!}.string();
            var iconPath={icon!}.string();
            var desc={desc!}.string();
            if(iconPath){
                toolbtn.style.backgroundImage='url('+iconPath+')';
            }else{
                toolbtn.style.backgroundImage="url(../images/nofind.png)";
            }
            part.check=function(){
                part.$.clearCheck();
                $t.removeClass(toolbtn,'bblue12');
                $t.addClasses(toolbtn,['bblue8','shadow-10']);
                $rootScope.sortPath=sortPath;
                $rootScope.toolicon=iconPath;
                $rootScope.desc=desc;
                $rootScope.toolName=name;
            }
            toolbtn.onclick=function(){
                part.check();
            }
        </script></xmp>
    <xmp ui="toolbtn" service="clearCheck">
        function(){
            var btns=$t.refs.toolbtn;
            for(var i=0;i<btns.length;i++){
                $t.removeClasses(btns[i],['bblue8','shadow-10']);
                $t.addClass(btns[i],'bblue12');
            }
            $rootScope.toolName='';
        }
    </xmp>
    
    <xmp ui='toolbar'>
        <div p-main class="imdip2 ihbgray15 ifloat ipdip5 irdip10 ibblue15 ict2 ifgray15 ihfgray0 ishadowless pdip5 uof">
            <set lazy append style="cursor: pointer;">
            <!scope m|data:props.data.split(','),i:0>
            <!for ;i<data.length;i++><div><!= data[i]></div><!end>
            </set>
        </div>
    </xmp>
    <xmp ui="procedureitem">
        <ui:growpanel lazy title:="props.title" class="uof">
            <div><!= props.sortPath>:<!= props.name></div>
            <div><!= props.fnName>:<a href='javascript:;'>target<script type="on">
                click:function(e){
                    console.log(props.targer);
                    console.log(props.outer);
                    console.log(props.outerElement);
                }
            </script></a></div>
            <div>props:<!= JSON.stringify(props.props)></div>
            <div></div>
        </ui:growpanel>
    </xmp>
    <xmp ui="procedure">
       <div p-ref="procedure" tabkey='procedure' tabname="过程" cancount class="full scrolly"></div>
        <script>
            var procedure=part.$procedure;
            
            part.push=function(name,sortPath,target,outer,outerElement,props,fnName){
                var $tab=part.parent;
                var tabItem=$tab.getItem('procedure');
                tabItem.count++;
                $t.renderIn('procedureitem','ui',procedure,outer,outerElement,{
                    name:name
                    ,sortPath:sortPath
                    ,target:target
                    ,outer:outer
                    ,outerElement:outerElement
                    ,props:props
                    ,fnName:fnName
                    ,title:(procedure.children.length+1)+'.插入'+name
                });
                
            }
        </script>
    </xmp>
    <xmp ui='droprect' extends='resizeui'>
        <div p-main ref='rect' p-ref="rect,resizeContent,resizeMain" style="background-color:rgba(0,128,255,0.5);" class="abs uhide">
            <div class="abs fz12 rem1 pdip8 pdipb0 shadowless bgray15 iinlineBlock ivalignt ilhem1" style="width:22em;top:-2.5em;">
                <input ref="useLeft" type="checkbox" checked="1"><span class="wem3" >左<!- rect.left></span>
                <input ref="useTop" type="checkbox" checked="1"><span class="wem3" >上<!- rect.top></span>
                <input ref="useWidth" type="checkbox" checked="1"><span class="wem3" >宽<!- rect.width></span>
                <input ref="useHeight" type="checkbox" checked="1"><span class="wem3" >高<!- rect.height></span>
                <input ref="useRect" type="checkbox" checked="1"><span>套用</span>
            </div>
            
            <ui:movepanel p-name='moreBox' class="top5 fz12 left5" style='cursor:crosshair;' >
                <div class="hem10 wem16 ct">
                    拖拽预设内容到此处
                </div>
            </ui:movepanel>
            <div style="margin-right:-2.5em;" class="imdipt3 abs right0 bottom5 iwem2 ihem2 iborderbox ipdip5 irem2 ilhem1 fz12 ishadowless ibgray15 ihfgray15 ifgray0 ipointer ict">
                <div class="hbred15" p-ref="cancel">x</div>
                <div class="hbgreen5" p-ref="ok">√</div>
            </div>
        </div>
        <script>
            var elemRect=part.$rect,
                moreBox=part.moreBox=$t.parts.moreBox.pop(),
                superResizeUI=part.getSuper('resizeui');
            moreBox.hide();
            
            part.x=0;
            part.y=0;
            $t.dropMove(elemRect,elemRect,0,false,function(){
                var r=$rootScope.rect;
                r.left=elemRect.offsetLeft-part.x;
                r.top=elemRect.offsetTop-part.y;
            });
            part.onInit=function(finalPart){
                finalPart.$pt.style.backgroundColor='#fff';
                var onresize=superResizeUI.onresize;
                superResizeUI.onresize=function(rect){
                    onresize(rect);
                    var r=$rootScope.rect;
                    r.width=elemRect.offsetWidth;
                    r.height=elemRect.offsetHeight;
                }
            };
            part.key='';
            window.addEventListener('keydown',function(e){
                part.key=e.which;
            });
            window.addEventListener('keyup',function(e){
                part.key='';
            });
        </script>
    </xmp>
    
    <xmp ui="source">
        <textarea p-main tabname="源码" class="fz18 h100 w100" style="resize: none;"></textarea>
        <script>
            // part.partMain.innerHTML=page.innerHTML;
            
        </script>
    </xmp>
    <xmp ui="disignbox">
        <div tabname="设计" class="full uof">
            <iframe p-ref="ifrm" src="../blank.html" class="full"></iframe>
            <div p-ref="panel" class="full uof" style="cursor:pointer;">
                
              <!--  
    <div>    3.点击矩形出现菜单（显示属性，跳转到dom节点）</div>
    <div>    5.拖移组件和标签（切换父和脱离父）</div>-->
                
                <div p-ref="rect2" style="background-color:rgba(0,128,255,0.2);z-index:2147483647;" class="abs uhide noevent"></div>
            </div>
        </div>
        <script>
            var panel=part.$panel,
                ifrm=part.$ifrm,
                rect2=part.$rect2,
                highlight=$t.refs.highlight.last(),
                pt1,pt2,
                elemRect,style,droprect,
                x1,y1,
                body=document.body,
                pib,
                drawtoolbar=$t.parts.drawtoolbar.pop();
            // part.onresize=function(){
                // ifrm.style.top=panel.style.top=drawtoolbar.partMain.offsetHeight+drawtoolbar.partMain.offsetTop+'px';
            // }
            var name;
            
            var dropRect=new $t.DropRect(panel,function(x,y){
                name=$rootScope.toolName;
                elemRect=$t.refs.rect.last();
                droprect=$t.parts.droprect.last();
                style=elemRect.style;
                $t.removeClass(elemRect,'uhide');
                var pos=$t.getOffsetPos(panel,document.body);
                droprect.x=x1=pos.x;
                droprect.y=y1=pos.y;
                style.left=body.scrollLeft+x+x1+'px';
                style.top=body.scrollTop+y+y1+'px';
                style.width='0';
                style.height='0';
            },function(rect){
                style.left=body.scrollLeft+rect.left+x1+'px';
                style.top=body.scrollTop+rect.top+y1+'px';
                style.width=rect.width+'px';
                style.height=rect.height+'px';
                droprect.emitResize();
                var r=$rootScope.rect;
                r.left=rect.left+body.scrollLeft;
                r.top=rect.top+body.scrollTop;
                r.width=rect.width;
                r.height=rect.height;
            },function(rect){
                if(droprect.key!==17){
                    $t.ui.toolbtn.service.clearCheck();    
                };
                $t.addClass(elemRect,'uhide');
                if(rect.width===0&&rect.height===0){
                    return;
                }
                pushUI(rect,name);
            });
            var pushUI=part.pushUI=function(rect,name){
                var elems=[];
                var begin=document.elementFromPoint(rect.screenLeft,rect.screenTop);
                elems.push(begin);
                var end=document.elementFromPoint(rect.screenLeft+rect.width,rect.screenTop+rect.height);
                if(begin!==end){
                    elems.push.apply(elems,getElementsBetween(begin,end));
                    elems.push(end);
                }
                /*键入参数*/
                var sortPath=$rootScope.sortPath; 
                var ui=$t.importUIHTML(name,sortPath);
                rect.left+=body.scrollLeft;
                rect.top+=body.scrollTop;
                $t.removeClass(elemRect,'uhide');
                $t.parts.pib.last().show(name,ui.getParamsHelp(),rect,function(props,iHTML,useRect,useLeft,useTop,useWidth,useHeight){
                    var div=document.createElement('div');
                    div.innerHTML=iHTML;
                    var outer=$t.slice.call(div.childNodes);
                    var outerElement=$t.slice.call(div.children);
                    if(elems.length>1){
                        var pos=$t.getOffsetPos(begin.parentNode,panel);
                        var render=$t.renderBefore;
                        $t.parts.procedure.last().push(name,sortPath,begin,outer,outerElement,props,'renderBefore');
                    }else{
                        var pos=$t.getOffsetPos(begin,panel);
                        var render=$t.renderIn;
                        $t.parts.procedure.last().push(name,sortPath,begin,outer,outerElement,props,'renderIn');
                    }
                    var part=render(name,'ui',begin,outer,outerElement,props);
                    if(useRect){
                        var scopeRect=$rootScope.rect;
                        var rect={left:scopeRect.left-pos.x,top:scopeRect.top-pos.y,width:scopeRect.width,height:scopeRect.height};
                        if(!useLeft){
                            rect.left='';
                        }
                        if(!useTop){
                            rect.top='';
                        }
                        if(!useWidth){
                            rect.width='';
                        }
                        if(!useHeight){
                            rect.height='';
                        }
                        part.setSize(rect);
                    }
                },function(){
                    $t.addClass(elemRect,'uhide');
                });
            }
            var select=part.select=function(rect,name){
                var elems=[];
                var begin=document.elementFromPoint(rect.screenLeft,rect.screenTop);
                elems.push(begin);
                var end=document.elementFromPoint(rect.screenLeft+rect.width,rect.screenTop+rect.height);
                elems.push.apply(elems,getElementsBetween(begin,end));
                elems.push(end);
            }
            panel.onmouseenter=function(){
                $t.ui.tooltip.service.hideAll();
            }
            function mouseMove(e){
                var elem=document.elementFromPoint(e.x,e.y);
                var pos=$t.getOffsetPos(elem,panel);
                var style=rect2.style;
                $t.removeClass(rect2,'uhide');
                style.left=pos.x+'px';
                style.top=pos.y+'px';
                style.width=elem.offsetWidth+'px';
                style.height=elem.offsetHeight+'px';
            }
            panel.ondblclick=function(e){
                var elem=e.target;
                $t.parts.tool1[0].check(2);
            }
            highlight.addEventListener('change',function(){
                if(highlight.checked){
                    panel.addEventListener('mousemove',mouseMove);
                    panel.addEventListener('mouseout',mouseOut);
                }else{
                    panel.removeEventListener('mousemove',mouseMove);
                    panel.removeEventListener('mouseout',mouseOut);
                }
            });
            function mouseOut(e){
                var pos=panel.compareDocumentPosition(e.toElement);
                if(pos<=4){
                    $t.addClass(rect2,'uhide');
                }
            }
            if(highlight.checked){
                panel.addEventListener('mousemove',mouseMove);
                panel.addEventListener('mouseout',mouseOut);
            }
            // panel.removeEventListener('mousemove',mouseMove);
            $t.bindFunction($rootScope,'toolName',$t.getStep(function(v){
                if(v){
                    panel.style.cursor="crosshair";
                    
                    dropRect.on();
                }else{
                    panel.style.cursor="pointer";
                    
                    dropRect.off();
                }
            },2));
            
            ifrm.onload=function(){
                
                var vdom0=$t.newVNode('document');
                vdom0.isClose=true;
                eval($t.toVarString('src,type,href,cheked,baseuipath,rel,tabname'));
                
                "龟牌虚拟dom第一种写法，一个节点一个节点添加"
                with($t.nodeName){
                    vdom0(null,10)()
                    (html)
                        (head)
                            (link)._(rel,'stylesheet')(href,"../css/turtle.min.css")()
                            (link)._(rel,'stylesheet')(href,"../css/base.css")()
                            (link)._(rel,'stylesheet')(href,"../css/fonts/font-awesome.min.css")()
                            (script)._(src,'../js/turtle.js')(baseuipath,"{name:'ui',path:'../ui'};{name:'app',path:'../uiAPP'}")()
                                .text2(function(/* 
                                    var 
                                        a=1,
                                        b=2,
                                        c=3;
                                    debugger;*/){})
                            ()
                            ('注释',8)()
                        ()
                        (body)
                            (xmp)
                                ('ui:tabbox')
                                    (div)._(tabname,'AAA')()
                                        ('AAA',3)()
                                    ()
                                    (div)._(tabname,'BBB')()
                                        ('BBB',3)()
                                    ()
                                ()
                            ()
                        ()
                    ();
                }
                
                "虚拟dom第二种写法，从字符串生成，此例子数据源为第1个写法的innerHTML"
                var vdom1=new $t.VDOM(vdom0.innerHTML);
                
                "虚拟dom第三种写法，设置节点innerHTML，此例子数据源为第2个写法的的innerHTML"
                var vdom2=$t.newVNode('document');
                vdom2.innerHTML=vdom1.innerHTML;
                
                ifrm.contentDocument.write(vdom2.innerHTML);
                ifrm.contentDocument.close();
            }
            
        </script>
    </xmp>
    <xmp>
        <!var toolName:'',sortPath:'',toolicon:'',desc:'',rect:{left:0,top:0,width:0,height:0}>
        <app:content key="Sandbox">
            <ui:button skin="fround" text='沙盘配置：官方组件'></ui:button>
            <input ref="highlight" type="checkbox" />鼠标高亮<span class="fgray8">（绘制组件时按住ctrl可多次绘制）</span>
            <ui:toolbar p-name="drawtoolbar" data="审查节点,审查组件,审查属性,审查API,前移,后移,上移,复制,剪切,粘贴,删除"></ui:toolbar>

            <set style="max-width:100%;"></set>
                <ui:splitbox height="768px" minwidth="150">
                    <div style="width:150px;">
                        <ui:tabbox lazy p-name="tool1">
                            <div tabname="组件" tabkey="part">
                                <div class="mdip5 fz14 hem4 shadowless rem1">
                                    <div show="toolName=''" class="ipdip15 ipointer ihbgray15 ihfgray0 fz14 uof irem1 ibblue15 ict2 imdip5 ifloat ifgray15 ishadowless iwem2 ilhem1">
                                        <div>新建组件</div>
                                        <div>编辑组件</div>
                                    </div>
                                    <div show="toolName!=''" class="pdipl10 pdip5"
                                        ><img : :src="toolicon" class="fz18 wem1 hem1 bblue12 rdip5 pdip2"
                                        /><span style="vertical-align: top;"><!- sortPath>:<!- toolName></span><span style="display:inline-block;cursor: pointer;font-size:16px;" class="abs right5 mdipl5 wem1 hem1 ct2 lhem1 pdip2 rem1 bred12 fgray15 hbred15">x
                                        <script type="on">click:function(){  
                                        $t.ui.toolbtn.service.clearCheck();                                          
                                    }</script></span><div><!- desc></div></div>
                                </div>
                                <!async>
                                <!! $rootScope.partsInfo=$t.require('partsInfo.js','partsInfo');>
                                <!var i:0,j:0>
                                <!for ;i<partsInfo.length;i++>
                                    <ui:growpanel extend="1" : title:="partsInfo[i].name">
                                        <ui:vctrl lazy minwidth="35">
                                        <!for j=0;j<partsInfo[i].data.length;j++>
                                            <ui:toolbtn : icon:="partsInfo[i].data[j].icon" sortpath:="partsInfo[i].data[j].sortPath" name:="partsInfo[i].data[j].name" desc:="partsInfo[i].data[j].desc"></ui:toolbtn>
                                        <!end>
                                        </ui:vctrl>
                                    </ui:growpanel>
                                <!end>
                                <!! part.emitResize()>
                                <!end>
                            </div>
                            <div tabname="模板"></div>
                            <div tabname="标签">
                            </div>
                        </ui:tabbox>
                    </div>
                    <div>
                        <ui:tabbox lazy>
                            <set lazy canclose tabname='index.html'>
                                <ui:tabbox lazy>
                                    <ui:disignbox></ui:disignbox>
                                    <div tabname="DOM树">DOM树</div>
                                    <ui:source></ui:source>
                                    <ui:procedure p-name="procedure"></ui:procedure>
                                </ui:tabbox>
                            </set>
                            <set lazy canclose tabname='content.html'>
                                <ui:tabbox lazy>
                                </ui:tabbox>
                            </set>
                        </ui:tabbox>
                    </div>
                    
                    <div style="width:200px;" noresize>
                        <ui:tabbox lazy>
                            <div tabname="标签属性">
                                
                            </div>
                        </ui:tabbox>
                        <app:paraminputbox p-name="pib"></app:paraminputbox>
                    </div>
                </ui:splitbox>
        </app:content>
        <ui:droprect p-name="droprect"></ui:droprect>
    </xmp>
  </body>
</html>

